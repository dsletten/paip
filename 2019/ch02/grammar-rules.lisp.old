;#!/usr/local/bin/sbcl --script

;;;;   Hey, Emacs, this is a -*- Mode: Lisp; Syntax: Common-Lisp -*- file!
;;;;
;;;;   Lisp...not just beautiful, but strangely beautiful.
;;;;   -- Paul Graham
;;;;
;;;;   Name:               grammar-rules.lisp
;;;;
;;;;   Started:            Thu Oct 10 00:19:47 2019
;;;;   Modifications:
;;;;
;;;;   Purpose:
;;;;
;;;;
;;;;
;;;;   Calling Sequence:
;;;;
;;;;
;;;;   Inputs:
;;;;
;;;;   Outputs:
;;;;
;;;;   Example:
;;;;
;;;;   Notes:
;;;;
;;;;
(load "/Users/dsletten/lisp/packages/test.lisp")

(defpackage :grammar-rules (:use :common-lisp :test))

(in-package :grammar-rules)

(defparameter *simple-grammar* '((s   -> (np vp))
                                 (np  -> (det n))
                                 (vp  -> (v np))
                                 (det -> the a)
                                 (n   -> man ball woman table)
                                 (v   -> hit took saw liked)))

(defvar *grammar* *simple-grammar*)

(defun sentence ()
  (append (noun-phrase) (verb-phrase)))

;; (defun noun-phrase ()
;;   (append (determiner) (noun)))

(defun noun-phrase ()
  (append (determiner) (adj*) (noun) (pp*)))

(defun verb-phrase ()
  (append (verb) (noun-phrase)))

(defun adj* ()
  (if (zerop (random 2))
      '()
      (append (adj) (adj*))))

(defun pp ()
  (append (prep) (noun-phrase)))

(defun pp* ()
  (if (random-elt '(t nil))
      (append (pp) (pp*))
      '()))

(defun determiner ()
  (one-of '(the a)))

(defun noun ()
  (one-of '(man ball woman table book website banana vector radio)))

;;;
;;;    All transitive!
;;;    
(defun verb ()
  (one-of '(hit took saw liked pardoned invited sold)))

(defun adj ()
  (one-of '(big little blue green wet smelly fabricated inverted simple pleasant fragrant abusive)))

(defun prep ()
  (one-of '(to in by with on under above below along beside within into onto)))

(defun one-of (set)
  "Pick one element of a set and make a list of it."
  (list (random-elt set)))

(defun random-elt (choices)
  "Choose a random element from a list."
  (elt choices (random (length choices))))
